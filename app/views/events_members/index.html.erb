<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <%= link_to root_path, class: "navbar-brand" do %>
        <%= image_tag("HeatAppLogo.png", alt: "Logo",  width: "80", height: "80", class: "d-inline-block align-top") %>
      <% end %>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <%= link_to "Members", members_path, class: "nav-link" %>
            </li>
            <li class="nav-item">
              <%= link_to "Events", events_path, class: "nav-link" %>
            </li>
            <% if is_officer_or_admin?(session) %>
              <li class="nav-item">
                <%= link_to "Event Attendance", events_members_path, class: "nav-link" %>
              </li>
            <% end %>
            <li class="nav-item">
              <%= link_to "Leaderboard", "/leaderboard", class: "nav-link" %>
            </li>
            <li class="nav-item">
              <%= link_to "Calendar", "/calendars", class: "nav-link" %>
            </li>

          </ul>
        </div>
        <div class="ml-auto">
          <% if current_user %>
          <div style="width: 75px; height: 75px; border-radius: 50%; overflow: hidden;">
            <%= link_to(check_member_attendance_path, onclick: "showEventsAndMeetings()") do %>
    <%= image_tag(current_user.avatar_url, style: "width: 100%; height: auto; border-radius: 50%; margin-bottom: 5px;") %>
  <% end %>

          </div>
          <%= button_to "Logout", destroy_user_session_path(redirect_to: root_path), data: { turbo: "false" }, method: :delete, class: "btn btn-success" %>
          <% else %>
          <%= link_to "Login", new_user_session_path, class: "btn btn-success" %>
          <% end %>
          <!-- Add the new button for reading the content -->
        </div>
      </div>
    </nav>

<div class="centered-content">
  <h1>Event Attendance</h1>
  
  <table class="table member-table" summary="Event attendance list">
    <thead>
      <tr>
        <th>Date</th>
        <th>Event</th>
        <th>Members</th>
        <th>Add Member</th>
      </tr>
    </thead>
    <tbody>
      <% @events.order(start_date: :desc).each do |event| %>
        <tr>
          <td><%= event.start_date.strftime("%B %d, %Y") %></td>
          <td><%= event.name %></td>
          <td>
            <% event_members = event.events_members %>
            <% if event_members.any? %>
              <ul>
                <% event_members.each do |event_member| %>
                  <li><%= event_member.member.name %></li>
                <% end %>
              </ul>
            <% else %>
              No attendees yet
            <% end %>
          </td>
          <td>
            <%= form_with(model: EventsMember.new, url: events_members_path, method: :post) do |form| %>
              <%= form.hidden_field :event_id, value: event.id %>
              <div class="form-group">
                <%= form.label :member_id, "Member" %>
                <%= form.collection_select :member_id, Member.all, :id, :name, prompt: "Select Member" %>
              </div>
              <%= form.submit "Add Member", class: "btn btn-primary" %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

    <%= link_to "Back to Members", members_path, class: "back-link" %>
    <%= link_to "Back to Events", events_path,class: "back-link"%>


    <%= link_to 'Export to Excel', events_export_path, class: "back-link"%>

  <br>

  <h2>Remove Member from Event</h2>
  <%= form_with(url: remove_member_from_event_events_members_path, method: :delete) do |form| %>
    <div class="form-group">
      <%= form.label :event_id, "Event" %>
      <%= form.collection_select :event_id, @events, :id, :name, prompt: "Select Event" %>
    </div>
    <div class="form-group">
      <%= form.label :member_id, "Member" %>
      <%= form.collection_select :member_id, @members, :id, :name, prompt: "Select Member" %>
    </div>
    <%= form.submit "Remove Member", class: "btn btn-danger" %>
  <% end %>
</div>

<footer class="footer">
    <p>Contact Us</p>
    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 10px;">
      <%= link_to "https://www.instagram.com/heattamu", target: "_blank" do %>
        <%= image_tag("instagram_logo.png", alt: "Instagram", width: "30", height: "30", class: "footer-icon") %>
      <% end %>
      
      <%= link_to "mailto:heattamu@gmail.com" do %>
        <%= image_tag("email_logo.png", alt: "Email", width: "30", height: "30", class: "footer-icon") %>
      <% end %>
      
      <%= link_to "https://www.tiktok.com/@heattamu", target: "_blank" do %>
        <%= image_tag("tiktok_logo.png", alt: "TikTok", width: "30", height: "30", class: "footer-icon") %>
      <% end %>
    </div>
    <p style="margin-top: 15px;">&copy; <%= Time.now.year %> Texas A&M H.E.A.T. All Rights Reserved.</p>
  </footer>

</body>