<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H.E.A.T.</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
      <%= link_to root_path, class: "navbar-brand" do %>
        <%= image_tag("HeatAppLogo.png", alt: "Logo", width: "80", height: "80", class: "d-inline-block align-top") %>
      <% end %>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <%= link_to "Members", members_path, class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Events", events_path, class: "nav-link" %>
          </li>
          <% if is_officer_or_admin?(session) %>
            <li class="nav-item">
              <%= link_to "Event Attendance", events_members_path, class: "nav-link" %>
            </li>
          <% end %>
          <li class="nav-item">
            <%= link_to "Leaderboard", "/leaderboard", class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Calendar", "/calendars", class: "nav-link" %>
          </li>
        </ul>
      </div>
      <div class="ml-auto">
        <% if current_user %>
        <div class="profile-img-wrapper" style="width: 75px; height: 75px; border-radius: 50%; overflow: hidden;">
          <%= link_to(check_member_attendance_path, onclick: "showEventsAndMeetings()") do %>
            <%= image_tag(current_user.avatar_url, style: "width: 100%; height: auto; border-radius: 50%; margin-bottom: 5px;") %>
          <% end %>
        </div>
        <%= button_to "Logout", destroy_user_session_path(redirect_to: root_path), data: { turbo: "false" }, method: :delete, class: "btn btn-success" %>
        <% else %>
        <%= link_to "Login", new_user_session_path, class: "btn btn-success" %>
        <% end %>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <p class="notice"><%= notice %></p>

    <h1>Members</h1>

    <div class="mb-3">
      <%# Filter buttons %>
      <% if params[:filter] != "dues" %>
        <%= link_to("Filter by Dues Paid", member_list_path(sort: params[:sort], order: params[:order], filter: "dues"), class: 'btn btn-primary') %>
      <% else %>
        <%= link_to("Remove Filter for Dues Paid", member_list_path(sort: params[:sort], order: params[:order], filter: nil), class: 'btn btn-primary') %>
      <% end %>

      <% if params[:filter] != "members" %>
        <%= link_to("Filter by Members only", member_list_path(sort: params[:sort], order: params[:order], filter: "members"), class: 'btn btn-primary') %>
      <% else %>
        <%= link_to("Remove Filter for Members", member_list_path(sort: params[:sort], order: params[:order], filter: nil), class: 'btn btn-primary') %>
      <% end %>

      <% if params[:filter] != "officers" %>
        <%= link_to("Filter by Officers", member_list_path(sort: params[:sort], order: params[:order], filter: "officers"), class: 'btn btn-primary') %>
      <% else %>
        <%= link_to("Remove Filter for Officers", member_list_path(sort: params[:sort], order: params[:order], filter: nil), class: 'btn btn-primary') %>
      <% end %>
    </div>

    <table class="table member-table" summary="Member list">
      <thead>
        <tr>
          <%# Name column with sorting %>
          <% if params[:sort] == "name" %>
            <% if params[:order] == "desc" %>
              <th><%= link_to(raw("Name &#8595;"), member_list_path(sort: "name", order: "asc"), class: 'btn btn-primary sort-btn') %></th>
            <% else %>
              <th><%= link_to(raw("Name &#8593;"), member_list_path, class: 'btn btn-primary sort-btn') %></th>
            <% end %>
          <% else %>
            <th><%= link_to("Name", member_list_path(sort: "name", order: "desc"), class: 'btn btn-primary sort-btn') %></th>
          <% end %>
          
          <%# Email column with sorting %>
          <% if params[:sort] == "email" %>
            <% if params[:order] == "desc" %>
              <th><%= link_to(raw("Email &#8595;"), member_list_path(sort: "email", order: "asc", filter: params[:filter]), class: 'btn btn-primary sort-btn') %></th>
            <% else %>
              <th><%= link_to(raw("Email &#8593;"), member_list_path, class: 'btn btn-primary sort-btn') %></th>
            <% end %>
          <% else %>
            <th><%= link_to("Email", member_list_path(sort: "email", order: "desc", filter: params[:filter]), class: 'btn btn-primary sort-btn') %></th>
          <% end %>

          <%# Points column with sorting %>
          <% if params[:sort] == "points" %>
            <% if params[:order] == "desc" %>
              <th><%= link_to(raw("Points &#8595;"), member_list_path(sort: "points", order: "asc", filter: params[:filter]), class: 'btn btn-primary sort-btn') %></th>
            <% else %>
              <th><%= link_to(raw("Points &#8593;"), member_list_path, class: 'btn btn-primary sort-btn') %></th>
            <% end %>
          <% else %>
            <th><%= link_to("Points", member_list_path(sort: "points", order: "desc", filter: params[:filter]), class: 'btn btn-primary sort-btn') %></th>
          <% end %>

          <th>Dues Paid</th>
          <th>Position</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @members.each do |member| %>
          <tr>
            <td><%= member.name %></td>
            <td><%= member.email %></td>
            <td><%= member.points %></td>
            <td><%= member.dues_paid? ? 'Yes' : 'No' %></td>
            <td><%= member.position || '-' %></td>
            <td class="actions">
              <%= link_to("Show", member_path(member), class: 'btn btn-primary') %>
              <%= link_to("Edit", edit_member_path(member), class: 'btn btn-primary') %>
              <%= link_to("Delete", member_path(member), class: 'btn btn-danger', data: { turbo_method: 'delete', turbo_confirm: "Are you sure?" }) %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <%= link_to "New member", new_member_path, class: 'btn btn-primary new-member-link' %>
  </div>

  <!-- Footer -->
  <footer class="footer" >
    <p>Contact Us</p>
    <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 10px;">
      <%= link_to "https://www.instagram.com/heattamu", target: "_blank" do %>
        <%= image_tag("instagram_logo.png", alt: "Instagram", width: "30", height: "30", class: "footer-icon") %>
      <% end %>
      
      <%= link_to "mailto:heattamu@gmail.com" do %>
        <%= image_tag("email_logo.png", alt: "Email", width: "30", height: "30", class: "footer-icon") %>
      <% end %>
      
      <%= link_to "https://www.tiktok.com/@heattamu", target: "_blank" do %>
        <%= image_tag("tiktok_logo.png", alt: "TikTok", width: "30", height: "30", class: "footer-icon") %>
      <% end %>
    </div>
    <p style="margin-top: 15px;">&copy; <%= Time.now.year %> Texas A&M H.E.A.T. All Rights Reserved.</p>
  </footer>
</body>
</html>
